<div class="container my-4">
  <!-- Feedback Form -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">Submit Feedback</div>
    <div class="card-body">
      <form [formGroup]="feedbackForm" (ngSubmit)="onSubmit()">
        <!-- Name -->
        <div class="mb-3">
          <label class="form-label">Name</label>
          <input
            type="text"
            class="form-control"
            formControlName="name"
            placeholder="Enter your name"
          />
          <div
            *ngIf="
              getControl('name')?.invalid &&
              (getControl('name')?.dirty || getControl('name')?.touched)
            "
            class="text-danger small mt-1"
          >
            <div *ngIf="getControl('name')?.errors?.['required']">
              Name is required.
            </div>
            <div *ngIf="getControl('name')?.errors?.['minlength']">
              Name must be at least 1 character.
            </div>
            <div *ngIf="getControl('name')?.errors?.['maxlength']">
              Name cannot exceed 100 characters.
            </div>
          </div>
        </div>

        <!-- Message -->
        <div class="mb-3">
          <label class="form-label">Message</label>
          <textarea
            class="form-control"
            rows="3"
            formControlName="message"
            placeholder="Enter your feedback"
          ></textarea>
          <div
            *ngIf="
              getControl('message')?.invalid &&
              (getControl('message')?.dirty || getControl('message')?.touched)
            "
            class="text-danger small mt-1"
          >
            <div *ngIf="getControl('message')?.errors?.['required']">
              Message is required.
            </div>
            <div *ngIf="getControl('message')?.errors?.['minlength']">
              Message must be at least 1 character.
            </div>
            <div *ngIf="getControl('message')?.errors?.['maxlength']">
              Message cannot exceed 2000 characters.
            </div>
          </div>
        </div>

        <!-- Rating -->
        <div class="mb-3">
          <label class="form-label">Rating</label>
          <div class="d-flex">
            <span
              *ngFor="let star of [1, 2, 3, 4, 5]"
              class="mx-1"
              role="button"
              (click)="setRating(star)"
            >
              <i class="fa fa-star text-warning"></i>
            </span>
          </div>
          <div
            *ngIf="
              getControl('rating')?.invalid &&
              (getControl('rating')?.dirty || getControl('rating')?.touched)
            "
            class="text-danger small mt-1"
          >
            <div
              *ngIf="
                getControl('rating')?.errors?.['required'] ||
                getControl('rating')?.errors?.['min'] ||
                getControl('rating')?.errors?.['max']
              "
            >
              Rating is required.
            </div>
          </div>
        </div>

        <!-- Submit -->
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="feedbackForm.invalid"
        >
          Submit
        </button>
      </form>
    </div>
  </div>

  <!-- Sorting -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0">Feedback List</h5>
    <div>
      <label class="me-2">Sort by:</label>
      <select
        class="form-select d-inline-block w-auto"
        [(ngModel)]="sortBy"
        (ngModelChange)="getFeedbackList()"
      >
        <option value="date">Submission Date</option>
        <option value="rating">Rating</option>
      </select>

      <label class="mx-2">Sort direction:</label>
      <select
        class="form-select d-inline-block w-auto"
        [(ngModel)]="sortDirection"
        (ngModelChange)="getFeedbackList()"
      >
        <option value="asc">Ascending</option>
        <option value="desc">Descending</option>
      </select>
    </div>
  </div>

  <!-- Feedback List -->
  <div *ngFor="let fb of feedbackList" class="card mb-3 shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-0">{{ fb.name }}</h6>
      </div>

      <p class="mt-2">{{ fb.message }}</p>

      <span *ngFor="let star of [].constructor(fb.rating)" class="mx-1">
        <i class="fa fa-star text-warning"></i>
      </span>

      <p class="mt-2">{{ fb.timestamp | date: 'yyyy-MM-ddTHH:mm:ss.SSSZ' }}</p>
    </div>
  </div>
</div>
